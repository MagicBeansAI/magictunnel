# Global-Level Pattern Rules for MagicTunnel Enterprise Allowlist
# These are ultimate fallback patterns when no tool-specific or capability-level rules match
# Lower priority numbers = higher precedence (evaluated first)

global_patterns:
  # Security blanket patterns (highest priority)
  - name: "emergency_keywords"
    pattern:
      type: regex
      value: ".*(?:emergency|critical|urgent|security|exploit|hack|breach).*"
    action: deny
    reason: "Emergency security keywords require manual review"
    priority: 1
    enabled: true
    
  - name: "credential_operations"
    pattern:
      type: regex
      value: ".*(?:password|key|token|secret|credential|auth|login|oauth).*"
    action: deny
    reason: "Credential operations require security approval"
    priority: 2
    enabled: true

  # Execution and system patterns
  - name: "execution_commands"
    pattern:
      type: regex
      value: ".*(?:exec|execute|run|launch|start|invoke|call|eval).*"
    action: deny
    reason: "Execution commands require explicit approval"
    priority: 3
    enabled: true
    
  - name: "privileged_operations"
    pattern:
      type: regex
      value: ".*(?:priv|privilege|elevated|super|admin|root).*"
    action: deny
    reason: "Privileged operations blocked by default"
    priority: 4
    enabled: true

  # Data modification patterns
  - name: "data_modification"
    pattern:
      type: regex
      value: ".*(?:modify|change|alter|update|edit|patch|replace).*"
    action: deny
    reason: "Data modification requires approval"
    priority: 5
    enabled: true
    
  - name: "configuration_changes"
    pattern:
      type: regex
      value: ".*(?:config|setting|preference|option|parameter).*"
    action: deny
    reason: "Configuration changes require review"
    priority: 6
    enabled: true

  # Network and external access
  - name: "external_communication"
    pattern:
      type: regex
      value: ".*(?:external|remote|api|http|https|url|endpoint|webhook).*"
    action: deny
    reason: "External communication requires security review"
    priority: 7
    enabled: true
    
  - name: "data_export"
    pattern:
      type: regex
      value: ".*(?:export|download|backup|dump|extract|sync).*"
    action: deny
    reason: "Data export operations require approval"
    priority: 8
    enabled: true

  # Safe operations (medium priority - allow with monitoring)
  - name: "read_only_operations"
    pattern:
      type: regex
      value: ".*(?:read|get|fetch|retrieve|view|show|display|list).*"
    action: allow
    reason: "Read-only operations generally safe"
    priority: 20
    enabled: true
    
  - name: "monitoring_tools"
    pattern:
      type: regex
      value: ".*(?:monitor|watch|observe|track|log|audit|metric).*"
    action: allow
    reason: "Monitoring tools permitted"
    priority: 25
    enabled: true
    
  - name: "validation_tools"
    pattern:
      type: regex
      value: ".*(?:validate|verify|check|test|lint|format).*"
    action: allow
    reason: "Validation tools are safe"
    priority: 30
    enabled: true

  # Documentation and help
  - name: "documentation_tools"
    pattern:
      type: regex
      value: ".*(?:doc|help|guide|manual|readme|tutorial|example).*"
    action: allow
    reason: "Documentation tools are safe"
    priority: 35
    enabled: true

  # Generic safe patterns (lower priority)
  - name: "information_tools"
    pattern:
      type: regex
      value: ".*(?:info|about|version|status|health|ping|echo).*"
    action: allow
    reason: "Information tools are safe"
    priority: 40
    enabled: true
    
  - name: "utility_tools"
    pattern:
      type: regex
      value: ".*(?:util|helper|format|convert|parse|sort|filter).*"
    action: allow
    reason: "Utility tools generally safe"
    priority: 45
    enabled: true

  # Catch-all patterns (lowest priority)
  - name: "safe_prefixes"
    pattern:
      type: regex
      value: "^(?:get|list|show|view|read|info|help|status)_.*"
    action: allow
    reason: "Tools starting with safe prefixes"
    priority: 50
    enabled: true
    
  - name: "analysis_tools"
    pattern:
      type: regex
      value: ".*(?:analyze|analyze|report|summary|statistics|stats).*"
    action: allow
    reason: "Analysis tools are safe"
    priority: 55
    enabled: true

# Ultimate fallback - if no patterns match, use configured default action
# This is handled by the allowlist service default_action setting

# Configuration metadata
metadata:
  version: "1.0.0"
  created: "2025-01-15"
  description: "Global fallback patterns for ultimate rule matching"
  total_patterns: 17
  coverage: "Comprehensive security and safety patterns"
  
# Pattern testing configuration
testing:
  enabled: true
  test_cases:
    - tool_name: "password_reset_user"
      expected_match: "credential_operations"
      expected_action: "deny"
    - tool_name: "execute_shell_command"
      expected_match: "execution_commands"
      expected_action: "deny"
    - tool_name: "get_system_info"
      expected_match: "read_only_operations"
      expected_action: "allow"
    - tool_name: "validate_json_schema"
      expected_match: "validation_tools"
      expected_action: "allow"
    - tool_name: "export_user_data"
      expected_match: "data_export"
      expected_action: "deny"
    - tool_name: "unknown_custom_tool"
      expected_match: null
      expected_action: "default"